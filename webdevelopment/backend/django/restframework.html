<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">

<head>
    <!-- Book generated using mdBook -->
    <meta charset="UTF-8">
    <title>Rest Framework - Knowledge Base</title>
    
    


    <!-- Custom HTML head -->
    


    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#ffffff" />

    
    
    <link rel="shortcut icon" href="../../../favicon.png">
    
    <link rel="stylesheet" href="../../../css/variables.css">
    <link rel="stylesheet" href="../../../css/general.css">
    <link rel="stylesheet" href="../../../css/chrome.css">
    
    <link rel="stylesheet" href="../../../css/print.css" media="print">
    

    <!-- Fonts -->
    <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
    
    <link rel="stylesheet" href="../../../fonts/fonts.css">
    

    <!-- Highlight.js Stylesheets -->
    <link rel="stylesheet" href="../../../highlight.css">
    <link rel="stylesheet" href="../../../tomorrow-night.css">
    <link rel="stylesheet" href="../../../ayu-highlight.css">

    <!-- Custom theme stylesheets -->
    

    
</head>

<body>
    <!-- Provide site root to javascript -->
    <script type="text/javascript">
        var path_to_root = "../../../";
        var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
    </script>

    <!-- Work around some values being stored in localStorage wrapped in quotes -->
    <script type="text/javascript">
        try {
            var theme = localStorage.getItem('mdbook-theme');
            var sidebar = localStorage.getItem('mdbook-sidebar');

            if (theme.startsWith('"') && theme.endsWith('"')) {
                localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
            }

            if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
            }
        } catch (e) { }
    </script>

    <!-- Set the theme before any content is loaded, prevents flash -->
    <script type="text/javascript">
        var theme;
        try { theme = localStorage.getItem('mdbook-theme'); } catch (e) { }
        if (theme === null || theme === undefined) { theme = default_theme; }
        var html = document.querySelector('html');
        html.classList.remove('no-js')
        html.classList.remove('light')
        html.classList.add(theme);
        html.classList.add('js');
    </script>

    <!-- Hide / unhide sidebar before it is displayed -->
    <script type="text/javascript">
        var html = document.querySelector('html');
        var sidebar = 'hidden';
        if (document.body.clientWidth >= 1080) {
            try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch (e) { }
            sidebar = sidebar || 'visible';
        }
        html.classList.remove('sidebar-visible');
        html.classList.add("sidebar-" + sidebar);
    </script>

    <nav id="sidebar" class="sidebar" aria-label="Table of contents">
        <div class="sidebar-scrollbox">
            <ol class="chapter"><li class="chapter-item affix "><a href="../../../index.html">Intro</a></li><li class="chapter-item affix "><a href="../../../acknowledgments.html">Acknowledgments</a></li><li class="chapter-item expanded "><a href="../../../webdevelopment/webdevelopment.html"><strong aria-hidden="true">1.</strong> Web Development</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../webdevelopment/frontend/frontend.html"><strong aria-hidden="true">1.1.</strong> Front-end</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../webdevelopment/frontend/css.html"><strong aria-hidden="true">1.1.1.</strong> CSS</a></li><li class="chapter-item "><a href="../../../webdevelopment/frontend/design.html"><strong aria-hidden="true">1.1.2.</strong> Design</a></li><li class="chapter-item "><a href="../../../webdevelopment/frontend/html.html"><strong aria-hidden="true">1.1.3.</strong> HTML</a></li><li class="chapter-item "><a href="../../../webdevelopment/frontend/js.html"><strong aria-hidden="true">1.1.4.</strong> Javascript</a></li><li class="chapter-item "><a href="../../../webdevelopment/frontend/Vue/vue.html"><strong aria-hidden="true">1.1.5.</strong> VueJs</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../webdevelopment/frontend/Vue/axios.html"><strong aria-hidden="true">1.1.5.1.</strong> Axios</a></li></ol></li><li class="chapter-item "><a href="../../../webdevelopment/frontend/nuxt.html"><strong aria-hidden="true">1.1.6.</strong> Nuxt</a></li></ol></li><li class="chapter-item expanded "><a href="../../../webdevelopment/backend/backend.html"><strong aria-hidden="true">1.2.</strong> Back-end</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../webdevelopment/backend/database/database.html"><strong aria-hidden="true">1.2.1.</strong> Database</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../webdevelopment/backend/database/sql.html"><strong aria-hidden="true">1.2.1.1.</strong> SQL</a></li><li class="chapter-item "><a href="../../../webdevelopment/backend/database/nosql.html"><strong aria-hidden="true">1.2.1.2.</strong> NoSQL</a></li></ol></li><li class="chapter-item "><a href="../../../webdevelopment/backend/hosting/hosting.html"><strong aria-hidden="true">1.2.2.</strong> Hosting</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../webdevelopment/backend/hosting/vps.html"><strong aria-hidden="true">1.2.2.1.</strong> VPS</a></li></ol></li><li class="chapter-item "><a href="../../../webdevelopment/backend/server/server.html"><strong aria-hidden="true">1.2.3.</strong> Servers</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../webdevelopment/backend/server/apache.html"><strong aria-hidden="true">1.2.3.1.</strong> Apache</a></li><li class="chapter-item "><a href="../../../webdevelopment/backend/server/nginx.html"><strong aria-hidden="true">1.2.3.2.</strong> NGINX</a></li><li class="chapter-item "><a href="../../../webdevelopment/backend/server/gunicorn.html"><strong aria-hidden="true">1.2.3.3.</strong> GUnicorn</a></li></ol></li><li class="chapter-item expanded "><a href="../../../webdevelopment/backend/django/django.html"><strong aria-hidden="true">1.2.4.</strong> Django</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../webdevelopment/backend/django/model.html"><strong aria-hidden="true">1.2.4.1.</strong> Models</a></li><li class="chapter-item "><a href="../../../webdevelopment/backend/django/view.html"><strong aria-hidden="true">1.2.4.2.</strong> Views</a></li><li class="chapter-item expanded "><a href="../../../webdevelopment/backend/django/restframework.html" class="active"><strong aria-hidden="true">1.2.4.3.</strong> Rest Framework</a></li><li class="chapter-item "><a href="../../../webdevelopment/backend/django/projectstartchecklist.html"><strong aria-hidden="true">1.2.4.4.</strong> Setup</a></li></ol></li><li class="chapter-item "><a href="../../../webdevelopment/backend/.md.html"><strong aria-hidden="true">1.2.5.</strong> DOM</a></li><li class="chapter-item "><a href="../../../webdevelopment/backend/sustainability.html"><strong aria-hidden="true">1.2.6.</strong> Sustainability / Scalability</a></li></ol></li><li class="chapter-item "><a href="../../../webdevelopment/projects/projects.html"><strong aria-hidden="true">1.3.</strong> Projects</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../webdevelopment/projects/raspberrypi.html"><strong aria-hidden="true">1.3.1.</strong> Raspberry Pi</a></li><li class="chapter-item "><a href="../../../webdevelopment/projects/tralelho.html"><strong aria-hidden="true">1.3.2.</strong> Tralelho</a></li></ol></li><li class="chapter-item "><a href="../../../webdevelopment/web/web.html"><strong aria-hidden="true">1.4.</strong> Web Technologies</a></li><li class="chapter-item "><a href="../../../webdevelopment/security/security.html"><strong aria-hidden="true">1.5.</strong> Security</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../webdevelopment/security/vulnerabilities.html"><strong aria-hidden="true">1.5.1.</strong> Vulnerabilities</a></li></ol></li><li class="chapter-item "><a href="../../../webdevelopment/testing/testing.html"><strong aria-hidden="true">1.6.</strong> Testing</a></li></ol></li><li class="chapter-item "><a href="../../../system/system.html"><strong aria-hidden="true">2.</strong> System Knowledge</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../system/hardware/hardware.html"><strong aria-hidden="true">2.1.</strong> Hardware</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../system/hardware/history.html"><strong aria-hidden="true">2.1.1.</strong> History</a></li></ol></li><li class="chapter-item "><a href="../../../system/software/software.html"><strong aria-hidden="true">2.2.</strong> Software</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../system/software/collaboration/collaboration.html"><strong aria-hidden="true">2.2.1.</strong> Collaboration</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../system/software/collaboration/discord.html"><strong aria-hidden="true">2.2.1.1.</strong> Discord</a></li><li class="chapter-item "><a href="../../../system/software/collaboration/slack.html"><strong aria-hidden="true">2.2.1.2.</strong> Slack</a></li><li class="chapter-item "><a href="../../../system/software/collaboration/teamviewer.html"><strong aria-hidden="true">2.2.1.3.</strong> Teamviewer</a></li></ol></li><li class="chapter-item "><a href="../../../system/software/os/os.html"><strong aria-hidden="true">2.2.2.</strong> OS</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../system/software/os/linux.html"><strong aria-hidden="true">2.2.2.1.</strong> Linux</a></li><li class="chapter-item "><a href="../../../system/software/os/windows.html"><strong aria-hidden="true">2.2.2.2.</strong> Windows</a></li><li class="chapter-item "><a href="../../../system/software/os/kernel.html"><strong aria-hidden="true">2.2.2.3.</strong> Kernels</a></li></ol></li><li class="chapter-item "><a href="../../../system/software/bios.html"><strong aria-hidden="true">2.2.3.</strong> Bios</a></li><li class="chapter-item "><a href="../../../system/software/uefi.html"><strong aria-hidden="true">2.2.4.</strong> UEFI</a></li><li class="chapter-item "><a href="../../../system/software/commandline.html"><strong aria-hidden="true">2.2.5.</strong> Commandline</a></li><li class="chapter-item "><a href="../../../system/software/elasticsearch.html"><strong aria-hidden="true">2.2.6.</strong> Elasticsearch</a></li><li class="chapter-item "><a href="../../../system/software/git.html"><strong aria-hidden="true">2.2.7.</strong> Git</a></li><li class="chapter-item "><a href="../../../system/software/github.html"><strong aria-hidden="true">2.2.8.</strong> Github</a></li><li class="chapter-item "><a href="../../../system/software/linters.html"><strong aria-hidden="true">2.2.9.</strong> Linters</a></li><li class="chapter-item "><a href="../../../system/software/packagemanagers.html"><strong aria-hidden="true">2.2.10.</strong> Packagemanagers</a></li><li class="chapter-item "><a href="../../../system/software/vscode.html"><strong aria-hidden="true">2.2.11.</strong> VSCode</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../../organisational/orga.html"><strong aria-hidden="true">3.</strong> Organisational</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../organisational/business/business.html"><strong aria-hidden="true">3.1.</strong> Business</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../organisational/business/autoentrepreneur.html"><strong aria-hidden="true">3.1.1.</strong> Auto-Entrpreneur</a></li></ol></li><li class="chapter-item "><a href="../../../organisational/legal/legal.html"><strong aria-hidden="true">3.2.</strong> Legal</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../organisational/legal/licenses.html"><strong aria-hidden="true">3.2.1.</strong> Licenses</a></li></ol></li></ol></li></ol>
        </div>
        <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
    </nav>

    <div id="page-wrapper" class="page-wrapper">

        <div class="page">
            
            <div id="menu-bar-hover-placeholder"></div>
            <div id="menu-bar" class="menu-bar sticky bordered">
                <div class="left-buttons">
                    <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents"
                        aria-label="Toggle Table of Contents" aria-controls="sidebar">
                        <i class="fa fa-bars"></i>
                    </button>
                    <button id="theme-toggle" class="icon-button" type="button" title="Change theme"
                        aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                        <i class="fa fa-paint-brush"></i>
                    </button>
                    <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                        <li role="none"><button role="menuitem" class="theme"
                                id="light">Light (default)</button></li>
                        <li role="none"><button role="menuitem" class="theme"
                                id="rust">Rust</button></li>
                        <li role="none"><button role="menuitem" class="theme"
                                id="coal">Coal</button></li>
                        <li role="none"><button role="menuitem" class="theme"
                                id="navy">Navy</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button>
                        </li>
                    </ul>
                    
                    <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)"
                        aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S"
                        aria-controls="searchbar">
                        <i class="fa fa-search"></i>
                    </button>
                    
                </div>

                <h1 class="menu-title">Knowledge Base</h1>

                <div class="right-buttons">
                    
                    <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                        <i id="print-button" class="fa fa-print"></i>
                    </a>
                    
                    
                    <a href="https://github.com/3ng7n33r/KnowledgeBase" title="Git repository" aria-label="Git repository">
                        <i id="git-repository-button" class="fa fa-github"></i>
                    </a>
                    
                </div>
            </div>

            
            <div id="search-wrapper" class="hidden">
                <form id="searchbar-outer" class="searchbar-outer">
                    <input type="search" name="search" id="searchbar" name="searchbar"
                        placeholder="Search this book ..." aria-controls="searchresults-outer"
                        aria-describedby="searchresults-header">
                </form>
                <div id="searchresults-outer" class="searchresults-outer hidden">
                    <div id="searchresults-header" class="searchresults-header"></div>
                    <ul id="searchresults">
                    </ul>
                </div>
            </div>
            

            <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
            <script type="text/javascript">
                document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                Array.from(document.querySelectorAll('#sidebar a')).forEach(function (link) {
                    link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                });
            </script>

            <div id="content" class="content">
                <main>
                    <h2 id="cors"><a class="header" href="#cors">Cors</a></h2>
<p>Cross origin resource  sharing is a security relevant aspect when Frontend and Backend communicate with each other from different ressources (urls, ports etc.). This attack vector can be mitigated by including specific information in the http header. For DRF, the cors middleware is suggested.</p>
<pre><code>$ pip install django-cors-headers
</code></pre>
<p>and add it to the settings.py:</p>
<pre><code class="language-py"> INSTALLED_APPS = [
	...
	'rest_framework',
	'corsheaders', # new
	...
]
MIDDLEWARE = [
...
'corsheaders.middleware.CorsMiddleware', # be sure to set it above Common
'django.middleware.common.CommonMiddleware',
...
]

CORS_ORIGIN_WHITELIST = (
'http://localhost:3000', # Frontend port, React in this case
'http://localhost:8000', # Django port
)
</code></pre>
<h2 id="authorization"><a class="header" href="#authorization">Authorization</a></h2>
<p>To manage authorizations in the api, the first step is to include the DRF urls into the projects url file. project/urls.py:</p>
<pre><code class="language-py">urlpatterns = [
    path('admin/', admin.site.urls),
    path('api/v1/', include('posts.urls')), # versioned API endpoint
    path('api-auth/', include('rest_framework.urls')), # adds authentication (the actual url is unimportant)
]
</code></pre>
<p>Permissions can be granted on project, view and object level. So for example to restrict permissions in a view to authenticated users this would have to be added:</p>
<pre><code class="language-py">from rest_framework import generics, permissions

class ExampleView(generics.ListCreateAPIView):
	permission_classes = (permissions.IsAuthenticated,) # The colon at the end is important
	...
</code></pre>
<p>To change permissions on a project level, edit the projects settings.py. Options are</p>
<ul>
<li>AllowAny (default)- any user, authenticated or not, has full access</li>
<li>IsAuthenticated - only authenticated, registered users have access</li>
<li>IsAdminUser - only admins/superusers have access</li>
<li>IsAuthenticatedOrReadOnly - unauthorized users can view any page,
but only authenticated users have write, edit, or delete
privileges:</li>
</ul>
<pre><code class="language-py">REST_FRAMEWORK = {
    'DEFAULT_PERMISSION_CLASSES': [
        'rest_framework.permissions.IsAuthenticated', # new
    ]
}
</code></pre>
<h3 id="custom-permissions"><a class="header" href="#custom-permissions">Custom Permissions</a></h3>
<p>It is possible to create custom permissions for a project. To do that, we create a permissions.py file in our app folder. An example for a custom permission could look like that:</p>
<pre><code class="language-py">from rest_framework import permissions

class IsAuthorOrReadOnly(permissions.BasePermission):
    def has_object_permission(self, request, view, obj):
        # Read-only permissions are allowed for any request
        if request.method in permissions.SAFE_METHODS:
	        return True
        # Write permissions are only allowed to the author of a post
        return obj.author == request.user
</code></pre>
<p>Here, we inherit Djangos BasePermissions class and overwrite its has_object_permission method to only grant write access to the author of a piece. First we check if the request method is safe (aka read only aka GET, OPTIONS and HEAD). If yes, permission is granted. If not, it is checked if the user is the author. We then have to import this permission class into our views.py file to enforce it on a view level:</p>
<pre><code class="language-py">from .permissions import IsAuthorOrReadOnly # new
...

class PostDetail(generics.RetrieveUpdateDestroyAPIView):
    permission_classes = (IsAuthorOrReadOnly,)
    ...
</code></pre>
<p>These methods work well for detail pages because it modifies the object permission. If it should be done for a list or collection, the queryset has to be overridden. More on that <a href="https://www.django-rest-framework.org/api-guide/filtering/#overriding-the-initial-queryset">here</a></p>
<h2 id="authentication"><a class="header" href="#authentication">Authentication</a></h2>
<p>While Authorizations manage permissions, Authentication manages login, logout and user management (create delete etc.). While Django uses a session based cookie, this is not possible for a REST API as the S in Rest stands for stateless. Therefore, every request has to be fully independent. The solution is to add a unique identifier into the request. This can be a token of any kind. DRF offers: basic, session, token, and default.</p>
<ul>
<li><strong>Basic</strong>: The string username:password is encoded into base64 and send under &quot;Authorization&quot; in the header. This should only be done through a secure https connection because the credentials can easily be stolen and reused.</li>
<li><strong>Session</strong>: After basic authentication, a cookie is generated <em>on both sides</em> that will further on be used to generate an ID which will be sent in the header. The database is only hit once for credentials and they are only in the first request, however managing these sessions for multiple front ends and many users is challenging and it is a stateful approach which violates the REST principle. This is therefore not advised.</li>
<li><strong>Token</strong>: Upon login, a token is created and stored only on the user side. It can be stored either in localstorage or as a cookie. The current best practice is to save it as a cooke with the httponly and Secure flags. Localstorage does not automatically add the token to the header and keeping it in both is vurlnerable for XSS attacks. The token is not stored server side. Additional features like token expiration can be set. This is currently considered the best approach. To add it 'rest_framework.authentication.TokenAuthentication', has to be added to the DEFAULT_AUTHENTICATION_CLASSES in settings.py and 'rest_framework.authtoken', has to be added to the INSTALLED_APPS</li>
<li><strong>Default</strong>: The default for DRF is Session and Basic. The session is used for the browsable API while basic is used for the API itself. If we would add the default class to the settings.py file to make it explicit, it would look like this: 
<pre><code class="language-py">REST_FRAMEWORK = {
'DEFAULT_PERMISSION_CLASSES': [
'rest_framework.permissions.IsAuthenticated',
],
'DEFAULT_AUTHENTICATION_CLASSES': [ 
'rest_framework.authentication.SessionAuthentication',
'rest_framework.authentication.BasicAuthentication'
],
}
</code></pre>
</li>
</ul>
<h2 id="user-endpoints"><a class="header" href="#user-endpoints">User Endpoints</a></h2>
<p>To have safe user endpoints to log in and out, we will use the third party packages <a href="https://github.com/jazzband/dj-rest-auth">dj-rest-auth</a> and <a href="https://github.com/pennersr/django-allauth">django-allauth</a>.</p>
<h3 id="dj-rest-auth-login-logout-password-reset"><a class="header" href="#dj-rest-auth-login-logout-password-reset">dj-rest-auth (Login Logout, Password reset)</a></h3>
<pre><code class="language-py">$ pip install dj-rest-auth

#settings.py
INSTALLED_APPS = [
	...
	# 3rd party
	...
	'dj_rest_auth',
]

#urls.py
urlpatterns = [
	...
	path('api/v1/dj-rest-auth/', include('dj_rest_auth.urls')), # new
]
</code></pre>
<p>The login can then be found under http://127.0.0.1:8000/api/v1/dj-rest-auth/login/ Further there are .../logout, .../password/reset and password/reset/confirm.</p>
<h3 id="django-allauth-user-registration"><a class="header" href="#django-allauth-user-registration">django-allauth (User Registration)</a></h3>
<pre><code class="language-py">$ pip install django-allauth

# settings.py
INSTALLED_APPS = [
	...
	'django.contrib.sites',
	# 3rd-party apps
	...
	'allauth',
	'allauth.account',
	'allauth.socialaccount',
	...
	'dj_rest_auth.registration',
]
EMAIL_BACKEND = 'django.core.mail.backends.console.EmailBackend' # this setting will send emails to the console during development
SITE_ID = 1 # allauth uses djangos sites framework (host multiple sites from one project), we only host one site but specification is needed anyway

# urls.py
urlpatterns = [
	...
	path('api/v1/dj-rest-auth/', include('dj_rest_auth.urls')),
	path('api/v1/dj-rest-auth/registration/', include('dj_rest_auth.registration.urls')),
]
</code></pre>
<h3 id="user-api-endpoint"><a class="header" href="#user-api-endpoint">User API endpoint</a></h3>
<p>Now that we can authenticate, we ant to add a user endpoint to our api to list all and individual users. Adding an endpoint always involves creating the serializer, creating the view, creating the url route. To add djangos usr model to the serializer, we write it like this (app/serializers.py):</p>
<pre><code class="language-py"># app/serializers.py
from django.contrib.auth import get_user_model # new
...

class UserSerializer(serializers.ModelSerializer):
	class Meta:
		model = get_user_model()
		fields = ('id', 'username',)


# app/views.py
from django.contrib.auth import get_user_model # new
from .serializers import PostSerializer, UserSerializer # new

...
class UserList(generics.ListCreateAPIView): # new
	queryset = get_user_model().objects.all()
	serializer_class = UserSerializer
class UserDetail(generics.RetrieveUpdateDestroyAPIView): # new
	queryset = get_user_model().objects.all()
	serializer_class = UserSerializer

# posts/urls.py
...
from .views import UserList, UserDetail
urlpatterns = [
	path('users/', UserList.as_view()),
	path('users/&lt;int:pk&gt;/', UserDetail.as_view()),
	...
]
</code></pre>
<h2 id="viewsets-and-routers"><a class="header" href="#viewsets-and-routers">Viewsets and Routers</a></h2>
<p>At this point we can see quite a bit of repetition. The detail view and the list view look exactly identical. We can use viewsets which combine these funtionalities for the sake of a worse readability. To replace the views we have so far, we rewrite views.py like this: </p>
<pre><code class="language-py"># posts/views.py
from django.contrib.auth import get_user_model
from rest_framework import viewsets # new
from .models import Post
from .permissions import IsAuthorOrReadOnly
from .serializers import PostSerializer, UserSerializer

class PostViewSet(viewsets.ModelViewSet): # new
	permission_classes = (IsAuthorOrReadOnly,)
	queryset = Post.objects.all()
	serializer_class = PostSerializer
class UserViewSet(viewsets.ModelViewSet): # new
	queryset = get_user_model().objects.all()
	serializer_class = UserSerializer
</code></pre>
<p>Just like viewsets unify list and detail views, routers can simplify url routes.</p>
<pre><code class="language-py">#before
from django.urls import path
from .views import UserList, UserDetail, PostList, PostDetail 

urlpatterns = [
    path('users/', UserList.as_view()), 
    path('users/&lt;int:pk&gt;/', UserDetail.as_view()), 
    path('', PostList.as_view()),
    path('&lt;int:pk&gt;/', PostDetail.as_view()),
# after
from django.urls import path
from rest_framework.routers import SimpleRouter
from .views import UserViewSet, PostViewSet

router = SimpleRouter()
router.register('users', UserViewSet, basename='users')
router.register('', PostViewSet, basename='posts')
urlpatterns = router.urls
</code></pre>
<p>It's not really clear if writing a little less code is worth the tradeoff in readability and customization. A good rule of thumb is to start with views and URLs. As your API grows in complexity if you find
yourself repeating the same endpoint patterns over and over again, then look to viewsets and
routers. Until then, keep things simple.</p>
<h2 id="schemas-and-documentation"><a class="header" href="#schemas-and-documentation">Schemas and documentation</a></h2>
<h3 id="schemas"><a class="header" href="#schemas">Schemas</a></h3>
<p>To add this, we have to install <a href="https://pyyaml.org/">PyYAML</a> and <a href="https://github.com/python-hyper/uritemplate">uritemplate</a></p>
<pre><code>$ pip install pyyaml uritemplate
</code></pre>
<p>then create a static computer readable schema with:</p>
<pre><code>$ python manage.py generateschema &gt; openapi-schema.yml
</code></pre>
<p>or we create a dynamic version that will be served to a url. For this, we have to change our projects urls.py like this:</p>
<pre><code class="language-py">...
from rest_framework.schemas import get_schema_view # new


urlpatterns = [
	...
    path('openapi', get_schema_view( # new
        title=&quot;Blog API&quot;,
        description=&quot;A sample API for learning DRF&quot;,
        version=&quot;1.0.0&quot;
    ), name='openapi-schema'),
]
</code></pre>
<h3 id="documentation"><a class="header" href="#documentation">Documentation</a></h3>
<p>To make it more human friendly, we install <a href="https://drf-yasg.readthedocs.io/en/stable/">drf-yasg</a> (however <a href="https://swagger.io/tools/swagger-ui/">SwaggerUI</a> and <a href="https://github.com/Rebilly/ReDoc">ReDoc</a> are viable alternatives).</p>
<h2 id="tutorial-summary"><a class="header" href="#tutorial-summary">Tutorial summary</a></h2>
<p>Rest - Representational state transfer
Api - application programming interface</p>
<pre><code>pip install djangorestframework
</code></pre>
<p>and add it to the Installed apps in settings.py:</p>
<pre><code>INSTALLED_APPS = [
     ....
    'rest_framework',
    ....
]
</code></pre>
<ol>
<li>
<p>The rest framework needs a serializer. The serializer explains how to format the db data into formats like json etc. in a get request or how to format a post request for data that goes into the db. 
The normal serializer class is written the same way as the model class with special methods to handle requests (get, post etc.). Because of these similarities in structure and API duties, the class can be simplified with Modelserializers. This can be as simple as: </p>
<pre><code class="language-python">from rest_framework import serializers
from app.models import Modelname

class  AppSerializer(serializers.ModelSerializer):
	class  Meta:
		model = App
		fields = ['id', 'title', 'other', 'important', 'fields']
</code></pre>
<p>The implementation can be checked in the django shell by importing the serializer and calling <em>$ print(repr(Serializername()))</em></p>
</li>
<li>
<p>Just like the Serializer often has similar tasks, the API IO is also normally fairly similar. Therefore, the view necessary to make the api connect with the outer world, can be simplified using generic class based views. An API that retrieves all elements of a database with a get request can be implemented like this:</p>
<pre><code class="language-python">from App.models import Modelname
from app.serializers import AppSerializer
from rest_framework import generics

class SnippetList(generics.ListCreateAPIView):
   queryset = App.objects.all()
   serializer_class = AppSerializer
</code></pre>
<p>and an API that retrieves, stores or deletes a single db entry:</p>
<pre><code class="language-python">class AppDetail(generics.RetrieveUpdateDestroyAPIView):
    queryset = App.objects.all()
    serializer_class = AppSerializer
</code></pre>
<p>More about generic views can be found <a href="https://www.django-rest-framework.org/api-guide/generic-views/">here</a>.
Note: in the urls file, class based views need the .asview method attached. To be able to use api suffixes (.json, .api) remember to modify the urlpatterns with</p>
<pre><code class="language-python">urlpatterns = format_suffix_patterns(urlpatterns)
</code></pre>
<ol start="3">
<li>Permissions can be handled with the <a href="https://www.django-rest-framework.org/api-guide/permissions/#api-reference">permission classes</a> in the generic views (rest_framework permissions need to be imported):</li>
</ol>
<pre><code class="language-python">class  SnippetDetail(generics.RetrieveUpdateDestroyAPIView):
	permission_classes = [permissions.IsAuthenticatedOrReadOnly,
	IsOwnerOrReadOnly]
</code></pre>
<p>In this example, &quot;IsownerOrReadOnly&quot; is a custom method defined in a permissions.py file. Documentation can be found <a href="https://www.django-rest-framework.org/tutorial/4-authentication-and-permissions/#object-level-permissions">here</a>
Authentication is built into the Rest framework and just needs to be included into the project level urls.py file:</p>
<pre><code class="language-python">urlpatterns += [
    path('anypath/', include('rest_framework.urls')),
]
</code></pre>
<ol start="3">
<li><a href="https://www.django-rest-framework.org/tutorial/5-relationships-and-hyperlinked-apis/">Pagination and Hyperlinking</a> in a nutshell: Let the serializer do the work. Make sure URL names fit and let the serialiser class inherit the HyperlinkedModelSerializer.</li>
</ol>
</li>
</ol>
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTY2NzIwNzUxOSwtMTE5NjAyNDcxNCwtMT
A0Njg1NDQ4MSwtMTI5MDY1ODI4NywzODEyOTU5NTIsLTExNjI0
Mjc4MjgsLTEwNTIzNTg2MTksLTczNTkwMTAwMiwtOTM5NDM0Mz
AyLDE2MzUyMjkxMDIsNjIxNjkyNzExLC0xOTQyNzIxMjk1LC00
NTQwMjM1MjIsLTE4MTk0NzEyMTMsLTE3NzI4MzY3MjAsLTEyMz
U1NjA0NjYsLTE3NTI5NDE3NzgsMTYyOTc5NjI5MCwyNjcxODcw
OTksLTIwMjEyNTM0NzRdfQ==
-->
                </main>

                <nav class="nav-wrapper" aria-label="Page navigation">
                    <!-- Mobile navigation buttons -->
                    
                    <a rel="prev" href="../../../webdevelopment/backend/django/view.html" class="mobile-nav-chapters previous"
                        title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    

                    
                    <a rel="next" href="../../../webdevelopment/backend/django/projectstartchecklist.html" class="mobile-nav-chapters next"
                        title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                    

                    <div style="clear: both"></div>
                </nav>
            </div>
        </div>

        <nav class="nav-wide-wrapper" aria-label="Page navigation">
            
            <a rel="prev" href="../../../webdevelopment/backend/django/view.html" class="nav-chapters previous" title="Previous chapter"
                aria-label="Previous chapter" aria-keyshortcuts="Left">
                <i class="fa fa-angle-left"></i>
            </a>
            

            
            <a rel="next" href="../../../webdevelopment/backend/django/projectstartchecklist.html" class="nav-chapters next" title="Next chapter"
                aria-label="Next chapter" aria-keyshortcuts="Right">
                <i class="fa fa-angle-right"></i>
            </a>
            
        </nav>

    </div>

    

    

    

    
    <script type="text/javascript">
        window.playground_copyable = true;
    </script>
    

    

    
    <script src="../../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../mark.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../searcher.js" type="text/javascript" charset="utf-8"></script>
    

    <script src="../../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../highlight.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../book.js" type="text/javascript" charset="utf-8"></script>

    <!-- Custom JS scripts -->
    

    

</body>

</html>